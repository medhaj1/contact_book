FROM node:20
WORKDIR /app

# Copy package files first (for better Docker layer caching)
COPY package.json package-lock.json ./

# Install dependencies with retry logic
RUN npm config set registry https://registry.npmjs.org/ && \
    npm install --no-optional --legacy-peer-deps || \
    npm install --no-optional --legacy-peer-deps || \
    npm install --no-optional --legacy-peer-deps

# Copy configuration files needed for styles
COPY tailwind.config.js postcss.config.js ./

# Don't copy source files - we'll mount them as volumes for hot reload

EXPOSE 3000

# Set environment variables for hot reload
ENV CHOKIDAR_USEPOLLING=true
ENV WATCHPACK_POLLING=true
ENV FAST_REFRESH=true

CMD ["npm", "start"]
